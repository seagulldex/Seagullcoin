<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seagull Bridge</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #000;
      color: #fff;
      padding: 2rem;
    }

    h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .form-box {
      background-color: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 15px rgba(30,144,255, 0.3);
    }

    label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    input, button {
      width: 100%;
      padding: 0.75rem;
      border-radius: 6px;
      border: 1px solid #444;
      background-color: #222;
      color: #fff;
    }

    input:focus {
      border-color: #1e90ff;
      outline: none;
    }

    button {
      background-color: #1e90ff;
      border: none;
      margin-top: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #0077cc;
    }

    .dropdown {
      position: relative;
      margin-bottom: 1rem;
    }

    .dropdown-selected {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem;
      background: #222;
      border: 1px solid #444;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
    }

    .dropdown-selected img {
      height: 24px;
      margin-right: 10px;
    }

    .dropdown-list {
      position: absolute;
      width: 100%;
      background: #222;
      border: 1px solid #444;
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      cursor: pointer;
      border-top: 1px solid #333;
    }

    .dropdown-item img {
      height: 24px;
      margin-right: 10px;
    }

    .dropdown-item:hover {
      background-color: #333;
    }

    .hidden {
      display: none;
    }

    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .modal-content {
      background-color: #111a3c;
      border: 1px solid #1f2b60;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      color: #f0f0f0;
      box-shadow: 0 0 20px rgba(0,170,228, 0.3);
    }

    .modal-content h3 {
      margin-bottom: 1rem;
      color: #00aae4;
    }

    .modal-actions {
      margin-top: 1.5rem;
      display: flex;
      justify-content: space-between;
      gap: 1rem;
    }

    .modal-actions button {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
    }

    #cancelModal {
      background-color: #333;
      color: #ccc;
    }

    #confirmModal {
      background-color: #00aae4;
      color: #fff;
    }

    #limitModal .modal-content {
      background-color: #111a3c;
      border: 1px solid #1f2b60;
      box-shadow: 0 0 20px rgba(0, 170, 228, 0.3);
      color: #f0f0f0;
    }

    #limitDismiss {
      background-color: #00aae4;
      color: #fff;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
    }
  </style>
</head>
<body>

<h2>Bridge Your Seagull Assets</h2>

<div class="form-box">
  <form id="bridge-form">

    <!-- Asset Type Dropdown -->
    <label>Asset Type</label>
    <div id="assetDropdown" class="dropdown"></div>

    <label>From Chain</label>
    <div id="fromDropdown" class="dropdown"></div>

    <label>To Chain</label>
    <div id="toDropdown" class="dropdown"></div>

    <label>Your Wallet Address (to receive)</label>
    <input type="text" id="receiveAddress" required />

    <label>Amount</label>
    <input type="number" id="amount" required min="0" step="any" />

    <button type="submit">Bridge Now</button>
  </form>
</div>

<div id="loading" class="hidden" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); color: white; font-size: 1.5rem; text-align: center; padding-top: 40vh; z-index: 9999;">
  Processing bridge...
</div>

<div id="confirmationModal" class="modal hidden">
  <div class="modal-content">
    <h3>Confirm Bridge</h3>
    <p id="modalDetails" style="white-space: pre-line;"></p>
    <div class="modal-actions">
      <button id="cancelModal">Cancel</button>
      <button id="confirmModal">Confirm</button>
    </div>
  </div>
</div>

<!-- Daily Limit Modal -->
<div id="limitModal" class="modal hidden">
  <div class="modal-content">
    <h3>Daily Bridge Limit Reached</h3>
    <p style="margin-top: 1rem;">
      We've hit the maximum daily limit for bridging <strong><span id="limitAssetName"></span></strong>.<br/>
      Please try again tomorrow.
    </p>
    <div class="modal-actions">
      <button id="limitDismiss">OK</button>
    </div>
  </div>
</div>

<script>
  const logos = {
    SeagullCoin: 'https://xpcdn.xpmarket.com/storage/logo/SeagullCoin_rnqiA8vuNriU9pqD1ZDGFH8ajQBL25Wkno.webp',
    SeagullCash: 'https://d1fdloi71mui9q.cloudfront.net/Z2URVu3eSjyXF3fPVdyq_png_20221121_111630_0000.png',
    XRP: 'https://altcoinsbox.com/wp-content/uploads/2023/01/xrp-logo-1140x1140.webp',
    HBAR: 'https://altcoinsbox.com/wp-content/uploads/2023/03/hedera-logo-1140x1140.webp',
    FLR: 'https://s2.coinmarketcap.com/static/img/coins/64x64/7950.png',
    XDC: 'https://cdn.coincircle.com/icons/fallback/xdc-network.png',
    XLM: 'https://files.swissborg.com/product/wealth-app/assets/ic_crypto_xlm.png',
    ALGO: 'https://cdn.freelogovectors.net/wp-content/uploads/2021/10/algorand-logo-freelogovectors.net_.png',
  };

  const bridgeAssets = {
    SeagullCash: ["XRP", "XLM", "HBAR", "ALGO"],
    SeagullCoin: ["XRP", "FLR", "XDC"]
  };

  let selectedAsset = "SeagullCash";
  let fromChain = "";
  let toChain = "";

  // Creates a custom dropdown with images, excludes optional values, and calls onSelect callback
  function createDropdown(id, options, onSelect, selectedValue, exclude) {
    const container = document.getElementById(id);
    container.innerHTML = "";

    // Filter out excluded options (like fromChain in toChain dropdown)
    const filteredOptions = exclude ? options.filter(opt => opt !== exclude) : options;

    const selectedDiv = document.createElement("div");
    selectedDiv.className = "dropdown-selected";
    container.appendChild(selectedDiv);

    const listDiv = document.createElement("div");
    listDiv.className = "dropdown-list";
    container.appendChild(listDiv);

    function update(value) {
      selectedDiv.innerHTML = `<div style="display:flex;align-items:center;"><img src="${logos[value]}" alt="${value}" /> ${value}</div>`;
      listDiv.style.display = "none";
      onSelect(value);
    }

    // Initialize selected
    if (!selectedValue || !filteredOptions.includes(selectedValue)) {
      selectedValue = filteredOptions[0];
    }
    update(selectedValue);

    // Populate dropdown list
    filteredOptions.forEach(opt => {
      const item = document.createElement("div");
      item.className = "dropdown-item";
      item.innerHTML = `<img src="${logos[opt]}" alt="${opt}" /> ${opt}`;
      item.onclick = () => {
        update(opt);
      };
      listDiv.appendChild(item);
    });

    selectedDiv.onclick = () => {
      listDiv.style.display = listDiv.style.display === "block" ? "none" : "block";
    };

    // Close dropdown if clicked outside
    document.addEventListener("click", (e) => {
      if (!container.contains(e.target)) {
        listDiv.style.display = "none";
      }
    });

    return {
      getValue: () => selectedValue,
      setValue: (val) => {
        if (filteredOptions.includes(val)) {
          update(val);
        }
      }
    };
  }

  // Initialize dropdowns
  let assetDropdown, fromDropdown, toDropdown;

  function initDropdowns() {
    assetDropdown = createDropdown("assetDropdown", Object.keys(bridgeAssets), (val) => {
      selectedAsset = val;
      refreshChainDropdowns();
    }, selectedAsset);

    refreshChainDropdowns();
  }

  function refreshChainDropdowns() {
    const chains = bridgeAssets[selectedAsset];

    // Set fromChain default to first chain if empty or invalid
    if (!chains.includes(fromChain)) {
      fromChain = chains[0];
    }

    // For toChain, exclude fromChain so they can't be the same
    let toChains = chains.filter(chain => chain !== fromChain);
    if (!toChains.includes(toChain)) {
      toChain = toChains[0];
    }

    if (fromDropdown) {
      // Rebuild fromDropdown with chains
      fromDropdown = createDropdown("fromDropdown", chains, (val) => {
        fromChain = val;
        // When fromChain changes, refresh toDropdown options excluding fromChain
        refreshToDropdown();
      }, fromChain);
    } else {
      fromDropdown = createDropdown("fromDropdown", chains, (val) => {
        fromChain = val;
        refreshToDropdown();
      }, fromChain);
    }

    refreshToDropdown();
  }

  function refreshToDropdown() {
    const chains = bridgeAssets[selectedAsset];
    // Exclude fromChain in toChain options
    const toChains = chains.filter(chain => chain !== fromChain);

    if (toDropdown) {
      toDropdown = createDropdown("toDropdown", toChains, (val) => {
        toChain = val;
      }, toChain);
    } else {
      toDropdown = createDropdown("toDropdown", toChains, (val) => {
        toChain = val;
      }, toChain);
    }
  }

  initDropdowns();

  // Bridge limit and usage
  const dailyLimits = {
    SeagullCash: 1000,
    SeagullCoin: 500
  };

  function getDailyUsage(asset) {
    const usage = localStorage.getItem(`bridge_usage_${asset}`);
    return usage ? parseFloat(usage) : 0;
  }

  function addDailyUsage(asset, amount) {
    const current = getDailyUsage(asset);
    localStorage.setItem(`bridge_usage_${asset}`, current + amount);
  }

  // Form submission with validation and confirmation modal
  const form = document.getElementById("bridge-form");
  const loading = document.getElementById("loading");
  const confirmationModal = document.getElementById("confirmationModal");
  const modalDetails = document.getElementById("modalDetails");
  const cancelModalBtn = document.getElementById("cancelModal");
  const confirmModalBtn = document.getElementById("confirmModal");
  const limitModal = document.getElementById("limitModal");
  const limitAssetName = document.getElementById("limitAssetName");
  const limitDismissBtn = document.getElementById("limitDismiss");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const amountInput = parseFloat(document.getElementById("amount").value);
    const receiveAddress = document.getElementById("receiveAddress").value.trim();

    if (isNaN(amountInput) || amountInput <= 0) {
      alert("Please enter a valid amount greater than 0.");
      return;
    }

    if (receiveAddress.length < 5) {
      alert("Please enter a valid wallet address.");
      return;
    }

    // Check daily limit
    const currentUsage = getDailyUsage(selectedAsset);
    const limit = dailyLimits[selectedAsset];

    if (currentUsage + amountInput > limit) {
      // Show limit modal
      limitAssetName.textContent = selectedAsset;
      limitModal.classList.remove("hidden");
      return;
    }

    // Show confirmation modal
    modalDetails.textContent =
      `Asset: ${selectedAsset}\n` +
      `From Chain: ${fromChain}\n` +
      `To Chain: ${toChain}\n` +
      `Amount: ${amountInput}\n` +
      `Receiving Address: ${receiveAddress}`;

    confirmationModal.classList.remove("hidden");
  });

  cancelModalBtn.addEventListener("click", () => {
    confirmationModal.classList.add("hidden");
  });

  confirmModalBtn.addEventListener("click", () => {
    confirmationModal.classList.add("hidden");
    loading.classList.remove("hidden");

    // Simulate bridge delay
    setTimeout(() => {
      loading.classList.add("hidden");
      alert("Bridge transaction submitted successfully!");

      // Add usage for daily limits
      const amountInput = parseFloat(document.getElementById("amount").value);
      addDailyUsage(selectedAsset, amountInput);

      form.reset();

      // Reset dropdowns to defaults after reset
      selectedAsset = Object.keys(bridgeAssets)[0];
      fromChain = "";
      toChain = "";
      initDropdowns();
    }, 3000);
  });

  limitDismissBtn.addEventListener("click", () => {
    limitModal.classList.add("hidden");
  });
</script>

</body>
</html>
