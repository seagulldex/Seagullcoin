<!DOCTYPE html>
<html>
  <head>
    <title>SGLCN-X20 Explorer</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
        background-color: #000;
        color: #fff;
      }
      .block {
        border: 1px solid #444;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 6px;
        background-color: #111;
      }
      h1 {
        display: flex;
        align-items: center;
        font-size: 2rem;
      }
      h1 img {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        margin-right: 10px;
      }
      a {
        color: #1e90ff;
      }
      .modal {
  background: #222;
  color: #eee;
  position: fixed;
  top: 10%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 600px;
  border: 2px solid #1e90ff;
  padding: 1rem 2rem;
  z-index: 1000;
  border-radius: 8px;
  display: none;
  box-shadow: 0 0 10px #1e90ff;
}
.modal.active {
  display: block;
}
.modal button {
  background: #1e90ff;
  border: none;
  color: white;
  padding: 0.5rem 1rem;
  margin-top: 1rem;
  cursor: pointer;
  border-radius: 4px;
}
    </style>
  </head>
  <body>
    <h1>
      <img src="https://pbs.twimg.com/profile_images/1874512448151314432/Axe_9hCH.jpg" alt="SeagullCoin Logo">
      SGLCN-X20 Block Explorer
    </h1>
    <input type="text" id="search" placeholder="Search by address or hash..." style="width: 100%; padding: 0.5rem; margin-bottom: 1rem;" />
    <div id="blocks">Loading...</div>

 <script>
  let allBlocks = [];

  const container = document.getElementById('blocks');
  const searchInput = document.getElementById('search');

  // Function to highlight matched terms inside a string
  function highlightMatch(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${query.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  // Render blocks filtered by query
  function renderBlocks(query = '') {
    const filtered = allBlocks.filter(block => {
      query = query.toLowerCase();

      if (block.hash.toLowerCase().includes(query)) return true;
      if (block.previousHash.toLowerCase().includes(query)) return true;
      if (block.transactions.some(tx =>
        tx.from.toLowerCase().includes(query) || tx.to.toLowerCase().includes(query)
      )) return true;

      return false;
    });

    container.innerHTML = '';

    if (filtered.length === 0) {
      container.innerHTML = '<p style="color: #f44336; font-weight: bold;">No results found.</p>';
      return;
    }

    filtered.forEach(block => {
      const div = document.createElement('div');
      div.className = 'block';

      div.innerHTML = `
        <p><strong>Index:</strong> ${block.index}</p>
        <p><strong>Timestamp:</strong> ${new Date(block.timestamp).toLocaleString()}</p>
        <p><strong>Hash:</strong> ${highlightMatch(block.hash, query)}</p>
        <p><strong>Previous Hash:</strong> ${highlightMatch(block.previousHash, query)}</p>
        <p><strong>Finalized:</strong> ${block.finalized ? '✅ Yes' : '⏳ No'}</p>
        <p><strong>Transactions:</strong></p>
        <ul>
          ${
            block.transactions.length === 0
              ? '<li>None</li>'
              : block.transactions.map(tx => {
                  const from = highlightMatch(tx.from, query);
                  const to = highlightMatch(tx.to, query);
                  return `<li>From: <strong>${from}</strong> → To: <strong>${to}</strong> — <strong>${tx.amount}</strong></li>`;
                }).join('')
          }
        </ul>
      `;
      container.appendChild(div);
    });
  }

  // Fetch blocks once and store them
  fetch('https://seagullcoin-dex-uaj3x.ondigitalocean.app/api/blocks')
    .then(res => res.json())
    .then(data => {
      allBlocks = data;
      renderBlocks();
    })
    .catch(err => {
      container.innerHTML = '❌ Failed to load blocks.';
      console.error(err);
    });

  // Filter blocks on search input
  searchInput.addEventListener('input', e => {
    renderBlocks(e.target.value.trim());
  });
</script>
  </body>
</html>
