<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mint Your NFT</title>
  <link rel="stylesheet" href="mint.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>Mint Your NFT</h1>
    </header>

    <form class="mint-form" id="mintForm">
      <input type="text" id="nftName" placeholder="NFT Name" required />

      <div id="dropArea" class="drop-area">
        <p>Drag & Drop your file here or click to select</p>
        <input type="file" id="nftFile" accept="image/*,video/*" required hidden />
        <div id="previewWrapper">
          <img id="nftPreview" alt="NFT Preview" />
          <video id="nftPreviewVideo" controls></video>
        </div>
      </div>

      <textarea id="nftDescription" placeholder="NFT Description" required></textarea>
      <input type="text" id="domain" placeholder="Domain (e.g., https://example.com)" />

      <div id="propertiesContainer">
        <h3>Properties</h3>
        <div class="property">
          <input type="text" placeholder="Property Name" class="property-name" />
          <input type="text" placeholder="Property Value" class="property-value" />
          <button type="button" class="removeProperty">-</button>
        </div>
      </div>
      <button type="button" id="addPropertyBtn">+ Add Property</button>

      <select id="collection">
        <option value="">-- Select or Create Collection --</option>
        <option value="new">+ Create New</option>
      </select>

      <button type="submit" class="mint-btn">Mint NFT</button>
    </form>

    <div class="spinner" id="spinner">
      <div class="beachball"></div>
    </div>
  </div>

  <!-- COLLECTION MODAL -->
  <div id="collectionModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Create New Collection</h2>
      <input type="text" id="collectionName" placeholder="Collection Name" required />
      <input type="file" id="collectionLogo" accept="image/*" />
      <input type="text" id="collectionDescription" placeholder="Description" />
      <input type="text" id="collectionDomain" placeholder="Domain" />
      <input type="text" id="collectionWebsite" placeholder="Website" />
      <input type="text" id="collectionTelegram" placeholder="Telegram Handle" />
      <div class="modal-actions">
        <button id="saveCollection">Save</button>
        <button id="cancelCollection">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('nftFile');
    const dropArea = document.getElementById('dropArea');
    const previewImg = document.getElementById('nftPreview');
    const previewVideo = document.getElementById('nftPreviewVideo');
    const addPropertyBtn = document.getElementById('addPropertyBtn');
    const propertiesContainer = document.getElementById('propertiesContainer');
    const collectionDropdown = document.getElementById('collection');
    const modal = document.getElementById('collectionModal');
    const cancelBtn = document.getElementById('cancelCollection');
    const MAX_PROPERTIES = 10;

    function resetPreview() {
      previewImg.style.display = 'none';
      previewVideo.style.display = 'none';
    }

    function showPreview(file) {
      resetPreview();
      const url = URL.createObjectURL(file);
      if (file.type.startsWith('image')) {
        previewImg.src = url;
        previewImg.style.display = 'block';
      } else if (file.type.startsWith('video')) {
        previewVideo.src = url;
        previewVideo.style.display = 'block';
      }
    }

    dropArea.addEventListener('click', () => fileInput.click());

    dropArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropArea.classList.add('drag-over');
    });

    dropArea.addEventListener('dragleave', () => {
      dropArea.classList.remove('drag-over');
    });

    dropArea.addEventListener('drop', (e) => {
      e.preventDefault();
      dropArea.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file) {
        fileInput.files = e.dataTransfer.files;
        showPreview(file);
      }
    });

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (file) showPreview(file);
    });

    addPropertyBtn.addEventListener('click', () => {
      const count = propertiesContainer.querySelectorAll('.property').length;
      if (count < MAX_PROPERTIES) {
        const div = document.createElement('div');
        div.className = 'property';
        div.innerHTML = `
          <input type="text" placeholder="Property Name" class="property-name" />
          <input type="text" placeholder="Property Value" class="property-value" />
          <button type="button" class="removeProperty">-</button>
        `;
        propertiesContainer.appendChild(div);
      } else {
        alert('Maximum of 10 properties allowed.');
      }
    });

    propertiesContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('removeProperty')) {
        e.target.parentElement.remove();
      }
    });

    collectionDropdown.addEventListener('change', () => {
      if (collectionDropdown.value === 'new') {
        modal.style.display = 'flex';
      }
    });

    cancelBtn.addEventListener('click', () => {
      modal.style.display = 'none';
      collectionDropdown.value = '';
    });

    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
        collectionDropdown.value = '';
      }
    });
  </script>
</body>
</html>
