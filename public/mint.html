<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SGLCN-X20 NFT Minter</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
    }
    nav {
      background: #111;
      display: flex;
      justify-content: center;
      gap: 40px;
      padding: 15px 0;
      box-shadow: 0 0 10px #222;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    nav a {
      color: #0ff;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    main {
      background-color: #111;
      border-radius: 20px;
      padding: 20px;
      max-width: 600px;
      margin: 30px auto;
      box-shadow: 0 0 15px #333;
    }
    input, textarea, select, button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #222;
      color: white;
    }
    label {
      margin-top: 15px;
      display: block;
    }
    .property-pair {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .property-pair input {
      flex: 1;
    }
    #collectionModal {
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:#000c;
      backdrop-filter: blur(3px);
      justify-content:center;
      align-items:center;
    }
    #collectionModal div {
      background:#111;
      padding:20px;
      border-radius:20px;
      width:90%;
      max-width:400px;
      color:white;
      box-shadow:0 0 20px #333;
    }
    #dropzone {
      border: 2px dashed #555;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      margin-top: 10px;
    }
    #dropzone.hover {
      background: #222;
    }
    #preview {
      margin-top: 10px;
      text-align: center;
    }
    #preview img, #preview video {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <nav>
    <a href="/">Home</a>
    <a href="/nfts.html">NFTs</a>
    <a href="/profile.html">Profile</a>
  </nav>

  <main>
    <h1>Mint a New NFT</h1>
    <form id="mintForm">
      <label>Name:</label>
      <input type="text" name="name" required>

      <label>Description:</label>
      <textarea name="description" rows="4"></textarea>

      <label>Upload File:</label>
      <div id="dropzone">Drag & Drop or Click to Upload</div>
      <input type="file" name="file" accept="image/*,video/*" required style="display:none;" id="fileInput">
      <div id="preview"></div>

      <label>Domain:</label>
      <input type="text" name="domain">

      <label>Properties (max 8):</label>
      <div id="propertiesContainer"></div>
      <button type="button" id="addPropertyButton">+ Add Property</button>

<!-- Add a new section for payment verification -->
<label>Minting Payment Status:</label>
<div id="paymentStatus">Not yet paid</div>
<button type="button" id="verifyPaymentButton">Verify Payment</button>
<button type="submit" id="mintNFTButton" disabled>Mint NFT</button>

      <label>Collection:</label>
      <select name="collection" id="collectionSelect">
        <option value="">No Collection</option>
        <option value="new">+ Create New Collection</option>
      </select>

      <button type="submit">Mint NFT</button>
    </form>
  </main>

  <!-- Collection Modal -->
  <div id="collectionModal">
    <div>
      <h2>Create New Collection</h2>
      <label>Collection Name:</label>
      <input type="text" id="newCollectionName" required>

      <label>Collection Logo:</label>
      <input type="file" id="newCollectionLogo" accept="image/*">

      <label>Description:</label>
      <textarea id="newCollectionDesc" rows="3"></textarea>

      <label>Website:</label>
      <input type="url" id="newCollectionWebsite">

      <label>X.com Link:</label>
      <input type="url" id="newCollectionX">

      <label>Telegram:</label>
      <input type="url" id="newCollectionTelegram">

      <button onclick="submitNewCollection()">Submit Collection</button>
      <button onclick="collectionModal.style.display='none'" style="margin-top:10px;background:#555;">Cancel</button>
    </div>
  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');

    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('dragover', e => {
      e.preventDefault();
      dropzone.classList.add('hover');
    });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('hover'));
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('hover');
      if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        showPreview(fileInput.files[0]);
      }
    });
    fileInput.addEventListener('change', () => {
      if (fileInput.files.length > 0) {
        showPreview(fileInput.files[0]);
      }
    });

    function showPreview(file) {
      preview.innerHTML = '';
      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
      } else if (file.type.startsWith('video/')) {
        const vid = document.createElement('video');
        vid.src = URL.createObjectURL(file);
        vid.controls = true;
        preview.appendChild(vid);
      }
    }

    const propertiesContainer = document.getElementById('propertiesContainer');
    const addButton = document.getElementById('addPropertyButton');

    addButton.addEventListener('click', () => {
      const count = propertiesContainer.querySelectorAll('.property-pair').length;
      if (count >= 8) {
        alert('Maximum of 8 properties allowed.');
        return;
      }
      const div = document.createElement('div');
      div.className = 'property-pair';
      div.innerHTML = `
        <input type="text" name="trait_type" placeholder="Trait Type">
        <input type="text" name="value" placeholder="Value">
      `;
      propertiesContainer.appendChild(div);
    });

    const collectionSelect = document.getElementById('collectionSelect');
    const collectionModal = document.getElementById('collectionModal');

    collectionSelect.addEventListener('change', () => {
      if (collectionSelect.value === 'new') {
        collectionModal.style.display = 'flex';
      }
    });

    async function submitNewCollection() {
      const name = document.getElementById('newCollectionName').value;
      const desc = document.getElementById('newCollectionDesc').value;
      const website = document.getElementById('newCollectionWebsite').value;
      const x = document.getElementById('newCollectionX').value;
      const telegram = document.getElementById('newCollectionTelegram').value;
      const logo = document.getElementById('newCollectionLogo').files[0];

      if (!name || !logo) {
        alert("Collection name and logo are required.");
        return;
      }

      const formData = new FormData();
      formData.append("name", name);
      formData.append("description", desc);
      formData.append("website", website);
      formData.append("x", x);
      formData.append("telegram", telegram);
      formData.append("logo", logo);

      try {
        const res = await fetch("/create-collection", {
          method: "POST",
          body: formData
        });
        const json = await res.json();
        if (json.success) {
          const option = document.createElement('option');
          option.value = json.collectionId;
          option.textContent = name;
          option.selected = true;
          collectionSelect.appendChild(option);
        } else {
          alert("Error creating collection: " + json.error);
        }
      } catch (err) {
        console.error(err);
        alert("Failed to create collection.");
      }

      collectionModal.style.display = 'none';
      document.getElementById('newCollectionName').value = '';
      document.getElementById('newCollectionDesc').value = '';
      document.getElementById('newCollectionWebsite').value = '';
      document.getElementById('newCollectionX').value = '';
      document.getElementById('newCollectionTelegram').value = '';
      document.getElementById('newCollectionLogo').value = '';
    }
const verifyPaymentButton = document.getElementById('verifyPaymentButton');
const mintNFTButton = document.getElementById('mintNFTButton');
const paymentStatus = document.getElementById('paymentStatus');

let paymentVerified = false;

// Mockup function to simulate payment verification
async function verifyPayment() {
  // Call your backend to verify payment
  try {
    const response = await fetch('/verify-payment', {
      method: 'POST',
      body: JSON.stringify({ walletAddress: 'USER_WALLET_ADDRESS' }), // Get this dynamically based on the user's wallet
      headers: { 'Content-Type': 'application/json' },
    });

    const result = await response.json();
    
    if (result.success && result.amountPaid === 0.5) {
      paymentVerified = true;
      paymentStatus.textContent = 'Payment Successful';
      mintNFTButton.disabled = false; // Enable mint button
    } else {
      paymentVerified = false;
      paymentStatus.textContent = 'Payment Failed: Insufficient Funds';
    }
  } catch (err) {
    console.error(err);
    paymentStatus.textContent = 'Payment Verification Failed';
  }
}

verifyPaymentButton.addEventListener('click', () => {
  verifyPayment();
});

// Mint NFT logic (Submit form after payment is verified)
document.getElementById('mintForm').addEventListener('submit', async (event) => {
  event.preventDefault();
  
  if (!paymentVerified) {
    alert('Please complete the payment before minting.');
    return;
  }

  // Proceed with NFT minting if payment is verified
  const formData = new FormData(event.target);
  
  try {
    const res = await fetch('/mint-nft', {
      method: 'POST',
      body: formData,
    });
    const json = await res.json();
    
    if (json.success) {
      alert('NFT Minted Successfully!');
    } else {
      alert('Minting Failed: ' + json.error);
    }
  } catch (err) {
    console.error(err);
    alert('Minting failed');
  }
});

  </script>
</body>
</html>
