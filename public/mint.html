<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint NFT - SeagullCoin NFT Minter</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/xumm-sdk/dist/xumm-sdk.bundle.js"></script>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #333;
            padding: 10px;
            position: relative;
        }

        nav ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            justify-content: flex-start;
        }

        nav ul li {
            margin-right: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
        }

        nav ul li a:hover {
            color: #f0a500;
        }

        #mint-form {
            background-color: #222;
            border-radius: 15px;
            padding: 20px;
            margin: 30px auto;
            max-width: 600px;
            box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.8);
        }

        .mint-form h2 {
            color: #f0a500;
            text-align: center;
            font-size: 28px;
        }

        .mint-form input, .mint-form textarea, .mint-form select {
            background-color: #444;
            color: white;
            border: 2px solid #666;
            border-radius: 10px;
            padding: 10px;
            width: 100%;
            margin-bottom: 15px;
        }

        .mint-form input[type="file"] {
            border: none;
            padding: 10px;
            background-color: #444;
            color: white;
            border-radius: 10px;
            width: 100%;
        }

        .mint-form button {
            background-color: #f0a500;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .mint-form button:hover {
            background-color: #d98c00;
        }

        .mint-form button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        #minting-progress {
            text-align: center;
            color: white;
            font-size: 18px;
        }

        footer {
            text-align: center;
            padding: 10px;
            background-color: #333;
            color: white;
        }

        .hero {
            text-align: center;
            margin-top: 50px;
        }

        .hero h1 {
            color: white;
            font-size: 36px;
        }

        .hero p {
            color: #ddd;
            font-size: 18px;
        }

        #connect-wallet-btn {
            background-color: #f0a500;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }

        #connect-wallet-btn:hover {
            background-color: #d98c00;
        }

        #wallet-info {
            color: white;
            font-size: 16px;
            margin-top: 20px;
        }

        #wallet-address {
            font-weight: bold;
        }

        /* Drag & Drop Upload Area */
        #upload-area {
            background-color: #333;
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #f0a500;
            text-align: center;
            color: #aaa;
            cursor: pointer;
        }

        #upload-area.dragging {
            background-color: #555;
        }

        .property-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .property-item input {
            margin-right: 10px;
            width: 45%;
        }

        .property-item button {
            background-color: #f0a500;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .property-item button:hover {
            background-color: #d98c00;
        }

        .property-item button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <!-- Navigation -->
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="nfts.html">NFTs</a></li>
                <li><a href="mint.html">Mint NFT</a></li>
            </ul>
            <a href="profile.html">
                <img src="https://pbs.twimg.com/profile_images/1874512448151314432/Axe_9hCH.jpg" 
                     alt="SeagullCoin Logo" style="height: 40px; width: auto; position: absolute; top: 10px; right: 10px;">
            </a>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <section class="hero">
            <h1>Mint Your SeagullCoin NFT</h1>
            <p>Mint an exclusive NFT using SeagullCoin. Only SeagullCoin (SGLCN-X20) is accepted for minting.</p>
            <button id="connect-wallet-btn">Connect Wallet via XUMM</button>
            <div id="wallet-info" style="display:none;">Connected: <span id="wallet-address"></span></div>
        </section>

        <!-- Minting Form -->
        <section id="mint-form" class="mint-form" style="display:none;">
            <h2>Create Your NFT</h2>
            <form id="mint-nft-form">
                <div>
                    <label for="nft-name">NFT Name:</label>
                    <input type="text" id="nft-name" required>
                </div>
                <div>
                    <label for="nft-description">Description:</label>
                    <textarea id="nft-description" required></textarea>
                </div>
                <div id="upload-area" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
                    <p>Drag and Drop Image or Click to Upload</p>
                    <input type="file" id="nft-file" accept="image/*" style="display:none" onchange="handleFileSelect(event)">
                </div>
                <div>
                    <label for="nft-domain">Domain:</label>
                    <input type="text" id="nft-domain">
                </div>
                <div id="properties-container">
                    <h3>Properties (Max 8):</h3>
                    <div id="properties-list"></div>
                    <button type="button" id="add-property-btn" onclick="addProperty()">Add Property</button>
                </div>
                <div>
                    <label for="nft-collection">Select Collection:</label>
                    <select id="nft-collection">
                        <option value="">None</option>
                    </select>
                </div>
                <button type="submit" id="mint-button" disabled>Mint NFT</button>
            </form>
        </section>

        <div id="minting-progress" style="display:none;">
            <p>Minting in Progress... Please wait.</p>
        </div>

        <div id="minting-result" style="display:none;">
            <p id="minting-message"></p>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 SeagullCoin NFT Marketplace</p>
    </footer>

    <script src="main.js"></script>

    <script>
        // Check login status when page loads
        async function checkLogin() {
            const res = await fetch('/api/login/check');
            const data = await res.json();

            if (data.loggedIn) {
                // User is logged in
                const wallet = data.account;
                localStorage.setItem('xummWallet', wallet);
                document.getElementById('connect-wallet-btn').style.display = 'none';
                document.getElementById('wallet-info').style.display = 'block';
                document.getElementById('wallet-address').innerText = wallet;
                
                unlockMinting();
                loadCollections();
            } else {
                // Not logged in
                document.getElementById('connect-wallet-btn').style.display = 'inline-block';
                document.getElementById('wallet-info').style.display = 'none';
                lockMinting();
            }
        }

        function showMintingProgress() {
            document.getElementById('minting-progress').style.display = 'block';
            document.getElementById('minting-result').style.display = 'none';
        }

        function hideMintingProgress() {
            document.getElementById('minting-progress').style.display = 'none';
        }

        function showMintingResult(success, message) {
            hideMintingProgress();
            document.getElementById('minting-result').style.display = 'block';
            const mintingMessage = document.getElementById('minting-message');
            if (success) {
                mintingMessage.innerText = `Minting Successful! NFT ID: ${message}`;
                mintingMessage.style.color = 'green';
            } else {
                mintingMessage.innerText = `Minting Failed: ${message}`;
                mintingMessage.style.color = 'red';
            }
        }

        // Click to start login
        document.getElementById('connect-wallet-btn').addEventListener('click', async () => {
            const res = await fetch('/api/login');
            const data = await res.json();
            if (data.next.always) {
                window.location.href = data.next.always; // Redirect to XUMM login
            }
        });

        // Dummy functions to lock/unlock minting
        function lockMinting() {
            const mintButton = document.getElementById('mint-button');
            if (mintButton) mintButton.disabled = true;
        }

        function unlockMinting() {
            const mintButton = document.getElementById('mint-button');
            if (mintButton) mintButton.disabled = false;
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function handleDrop(event) {
            event.preventDefault();
            const file = event.dataTransfer.files[0];
            handleFileSelect({ target: { files: [file] } });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                document.getElementById('upload-area').innerText = `File: ${file.name}`;
            } else {
                alert('Please select a valid image file');
            }
        }

        // Add property input field
        let propertyCount = 0;
        function addProperty() {
            if (propertyCount >= 8) return; // Limit to 8 properties
            propertyCount++;

            const propertyItem = document.createElement('div');
            propertyItem.classList.add('property-item');

            const nameInput = document.createElement('input');
            nameInput.placeholder = 'Property Name';
            nameInput.required = true;

            const valueInput = document.createElement('input');
            valueInput.placeholder = 'Property Value';
            valueInput.required = true;

            const removeButton = document.createElement('button');
            removeButton.innerText = 'Remove';
            removeButton.type = 'button';
            removeButton.onclick = () => {
                propertyItem.remove();
                propertyCount--;
            };

            propertyItem.appendChild(nameInput);
            propertyItem.appendChild(valueInput);
            propertyItem.appendChild(removeButton);

            document.getElementById('properties-list').appendChild(propertyItem);
        }

        // Load collections dynamically
        async function loadCollections() {
            const res = await fetch('/api/collections');
            const collections = await res.json();
            const collectionSelect = document.getElementById('nft-collection');

            collections.forEach(collection => {
                const option = document.createElement('option');
                option.value = collection.id;
                option.innerText = collection.name;
                collectionSelect.appendChild(option);
            });
        }

        // Call checkLogin when page loads
        window.onload = checkLogin;
    </script>
</body>
</html>
