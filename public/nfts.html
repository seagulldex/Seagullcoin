<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trading - SGLCN-X20</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="header.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0/dist/chartjs-chart-financial.min.js"></script>
  <style>
    #timeframe-buttons {
      margin-bottom: 15px;
    }
    #timeframe-buttons button {
      margin-right: 8px;
      background-color: #2196F3;
      color: white;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      padding: 6px 12px;
    }
    #timeframe-buttons button.active {
      background-color: #0b7dda;
    }
    #priceChart {
      max-width: 700px;
      margin-bottom: 30px;
      display: block;
    }
    #wallet-indicator.red {
      color: red;
      cursor: pointer;
    }
    #wallet-indicator.green {
      color: green;
      cursor: default;
    }
    button {
      padding: 8px 12px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <div id="top-bar" style="display:flex; align-items:center; justify-content:space-between; padding:10px;">
    <div style="flex:1;">
      <button id="logout-btn" style="display:none;">Logout</button>
    </div>
    <div id="wallet-container">
      <div id="wallet-status">
        <span id="wallet-indicator" class="red">ðŸ”´ Login</span>
      </div>
    </div>
  </div>

  <header>
    <nav>
      <ul style="display:flex; gap:15px; list-style:none; padding-left:0;">
        <li><a href="index.html">Home</a></li>
        <li><a href="stake.html">Stake</a></li>
        <li><a href="https://sglcn-x20-api.glitch.me/SeagullmansionsV2.html" target="_blank" rel="noopener noreferrer">SGLMN V2 (mint)</a></li>
      </ul>
    </nav>
  </header>

  <main style="max-width: 900px; margin: auto; padding: 15px;">
    <h1>Trading</h1>

    <h2>SGLCN/XRP Price Chart</h2>

    <div id="timeframe-buttons">
      <button data-timeframe="1h" class="active">1 Hour</button>
      <button data-timeframe="6h">6 Hours</button>
      <button data-timeframe="24h">24 Hours</button>
      <button data-timeframe="7d">7 Days</button>
      <button data-timeframe="1m">Monthly</button>
      <button data-timeframe="max">Max</button>
    </div>

    <canvas id="priceChart"></canvas>
  </main>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      updateWalletStatus();
      setupTimeframeButtons();
      updateChartForTimeframe('1h');
    });

    // Wallet login/logout and status
    function updateWalletStatus() {
      const wallet = localStorage.getItem('xumm_wallet_address');
      const indicator = document.getElementById('wallet-indicator');
      const logoutBtn = document.getElementById('logout-btn');

      if (wallet) {
        indicator.textContent = 'ðŸŸ¢ Connected';
        indicator.classList.replace('red', 'green');
        indicator.title = 'Logged in as ' + wallet;
        indicator.onclick = null;
        logoutBtn.style.display = 'inline-block';
        logoutBtn.onclick = () => {
          localStorage.removeItem('xumm_wallet_address');
          updateWalletStatus();
        };
      } else {
        indicator.textContent = 'ðŸ”´ Login';
        indicator.classList.replace('green', 'red');
        indicator.title = 'Click to login';
        indicator.onclick = startLoginFlow;
        logoutBtn.style.display = 'none';
      }
    }

    async function startLoginFlow() {
      try {
        const res = await fetch('https://sglcn-x20-api.glitch.me/login');
        const data = await res.json();
        window.open(data.payloadURL, "_blank");

        const interval = setInterval(async () => {
          const check = await fetch(`https://sglcn-x20-api.glitch.me/check-login?uuid=${data.payloadUUID}`);
          const loginStatus = await check.json();
          if (loginStatus.loggedIn) {
            clearInterval(interval);
            localStorage.setItem('xumm_wallet_address', loginStatus.account);
            updateWalletStatus();
          }
        }, 3000);
      } catch (e) {
        alert("Login failed, please try again.");
        console.error(e);
      }
    }

    // Timeframe buttons and chart logic (example placeholders)
    function setupTimeframeButtons() {
      const buttons = document.querySelectorAll('#timeframe-buttons button');
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          updateChartForTimeframe(btn.dataset.timeframe);
        });
      });
    }

    function updateChartForTimeframe(timeframe) {
      // Fetch and update chart data for timeframe
      // Placeholder example below:
      const ctx = document.getElementById('priceChart').getContext('2d');
      if (window.priceChartInstance) {
        window.priceChartInstance.destroy();
      }
      window.priceChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['0', '1', '2', '3', '4', '5'],
          datasets: [{
            label: `Price (${timeframe})`,
            data: [100, 105, 102, 108, 110, 115],
            borderColor: 'blue',
            fill: false,
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { display: true },
            y: { display: true }
          }
        }
      });
    }
  </script>
</body>
</html>
