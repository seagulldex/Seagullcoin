<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SGLCN-X20 NFT Explorer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f2f2f2;
    }
    header {
      background-color: #0d0d0d;
      padding: 10px 20px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    main {
      padding: 20px;
    }
    .spinner {
      display: none;
      text-align: center;
      margin-top: 20px;
    }
    .spinner img {
      width: 40px;
    }
    #nft-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    .nft-card {
      background: white;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
    }
    .nft-card img {
      max-width: 100%;
      border-radius: 8px;
    }
    .pagination {
      text-align: center;
      margin-top: 20px;
    }
    .pagination button {
      margin: 0 5px;
      padding: 6px 12px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>SGLCN-X20 NFT Explorer</h1>
  </header>
  <main>
    <div class="spinner" id="loading-spinner">
      <img src="https://cdn.glitch.global/placeholder/loading-spinner.gif" alt="Loading..."/>
    </div>
    <div id="nft-container"></div>
    <div class="pagination" id="pagination"></div>
  </main>

  <script>
    const walletAddress = "rKoREYA3cFXPbAUtfj1Y2duMMymuWpuNDE";
    let allNFTs = [];
    let currentPage = 1;
    const pageSize = 12;

    async function fetchNFTs(wallet) {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 seconds

      try {
        document.getElementById('loading-spinner').style.display = 'block';
        document.getElementById('nft-container').style.display = 'none';

        const res = await fetch(`https://sglcn-x20-api.glitch.me/nfts/${wallet}`, {
          signal: controller.signal
        });
        const data = await res.json();
        allNFTs = (data.nfts || []).filter(nft => nft.metadata && nft.metadata.image && nft.metadata.name);
        displayPage(1);
      } catch (err) {
        if (err.name === 'AbortError') {
          console.error("NFT fetch error: Request timed out");
          document.getElementById('nft-container').innerHTML = "<p style='color:red;'>Request timed out. Please try again later.</p>";
        } else {
          console.error("NFT fetch error:", err);
          document.getElementById('nft-container').innerHTML = "<p style='color:red;'>Failed to load NFTs.</p>";
        }
      } finally {
        clearTimeout(timeoutId);
        document.getElementById('loading-spinner').style.display = 'none';
        document.getElementById('nft-container').style.display = 'grid';
      }
    }

    function displayPage(page) {
      currentPage = page;
      const container = document.getElementById('nft-container');
      container.innerHTML = "";

      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const nftsToShow = allNFTs.slice(start, end);

      for (const nft of nftsToShow) {
        const card = document.createElement('div');
        card.className = 'nft-card';
        card.innerHTML = `
          <img src="${nft.metadata.image}" alt="${nft.metadata.name}">
          <h3>${nft.metadata.name}</h3>
          <p>${nft.metadata.description || ''}</p>
        `;
        container.appendChild(card);
      }

      updatePagination();
    }

    function updatePagination() {
      const totalPages = Math.ceil(allNFTs.length / pageSize);
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = "";

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.disabled = (i === currentPage);
        btn.onclick = () => displayPage(i);
        pagination.appendChild(btn);
      }
    }

    // Initial fetch
    fetchNFTs(walletAddress);
  </script>
</body>
</html>
